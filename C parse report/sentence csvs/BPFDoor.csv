Number,Content
Sentence 1,"BPFDoor — an active Chinese global surveillance tool

Kevin Beaumont May 7, 2022

Recently, PwC Threat Intelligence documented the existence of BPFDoor, a passive network implant for Linux they attribute to Red Menshen, a Chinese threat actor group."
Sentence 2,"You can read more in PwC’s great, yearly threat intelligence brief, here."
Sentence 3,"
PwC plan to present their findings in June:
BPFDoor is interesting."
Sentence 4,"It allows a threat actor to backdoor a system for remote code execution, without opening any new network ports or firewall rules."
Sentence 5,"For example, if a webapp exists on port 443, it can listen and react on the existing port 443, and the implant can be reached over the webapp port (even with the webapp running)."
Sentence 6,This is because it uses a BPF packet filter.
Sentence 7,"Operators have access to a tool which allows communication to the implants, using a password, which allows features such as remotely executing commands."
Sentence 8,This works over internal and internet networks.
Sentence 9,"Because BPFDoor doesn’t open any inbound network ports, doesn’t use an outbound C2, and it renames its own process in Linux (so ps aux, for example, will show a friendly name) it is highly evasive."
Sentence 10,"I swept the internet for BPFDoor throughout 2021, and discovered it is installed at organisations in across the globe— in particular the US, South Korea, Hong Kong, Turkey, India, Viet Nam and Myanmar, and is highly evasive."
Sentence 11,"These organisations include government systems, postal and logistic systems, education systems and more."
Sentence 12,Inside those organisations I believe it is likely present on thousands of systems.
Sentence 13,The implant appears to be for surveillance purposes.
Sentence 14,"
Per PwC:
We also identified that the threat actor sends commands to BPFDoor victims via Virtual Private Servers (VPSs) hosted at a well-known provider, and that these VPSs, in turn, are administered via compromised routers based in Taiwan, which the threat actor uses as VPN tunnels."
Sentence 15,"Most Red Menshen activity that we observed took place between Monday to Friday (with none observed on the weekends), with most communication taking place between 01:00 and 10:00 UTC."
Sentence 16,"This pattern suggests a consistent 8 to 9-hour activity window for the threat actor, with realistic probability of it aligning to local working hours."
Sentence 17,The implant has been in use for many years — over 5 — and has flown under the radar.
Sentence 18,"Versions exist for Linux appliances, Solaris SPARC boxes and more."
Sentence 19,"For example, here’s a Solaris version first uploaded to VirusTotal in 2019:

VirusTotal — File — dc8346bf443b7b453f062740d8ae8d8d7ce879672810f4296158f90359dcae3a

Nextron Systems THOR was detecting the activity over the past year or so, visible in VirusTotal comments:
Indicators of Compromise and Indicators of Attack
(note that each implant has a unique hash, so hunting for file hashes is a BAD IDEA)."
Sentence 20,"VirusTotal — Collections — BPFDoor

YARA rules:
signature-base/mal_lnx_implant_may22.yar at master · Neo23x0/signature-base (github.com)

ThreatHunting/BPFDoor-Unknown.yar at master · GossiTheDog/ThreatHunting (github.com)

Files in /dev/shm such as /dev/shm/kdmtmpflush
Sandbox report from 2019 — includes useful commands; Automated Malware Analysis Report for m8XMnec4Vb.elf — Generated by Joe Sandbox
"
Sentence 21,"
BPFDoor Source Code
Florian found BPFDoor controller source code on VirusTotal:
This seems to be a source code for the #BPFDoor malware (the controller) used by the Red Menshen TA 

Maybe @jcksnsec can take a look at it for confirmation 

Sample
https://virustotal.com/gui/file/8b9db0bc9152628bdacc32dab01590211bee9f27d58e0f66f6a1e26aea7552a6/detection

Source
https://pastebin.com/kmmJuuQP

This is for an older version of the implant, from around 2018."
Sentence 22,"It is available on Pastebin here: Red Menshen BPFDoor Source Code — Pastebin.com
"
Sentence 23,"
Technical artefact analysis
Craig Rowland has a great initial look at BPFDoor, from an older version, in this thread (expand for details)."
